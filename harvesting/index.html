
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href=".." rel="prev"/>
<link href="../cli/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.0" name="generator"/>
<title>Harvesting the Metadata - Catalog</title>
<link href="../assets/stylesheets/main.618322db.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="custom" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#data-harvesting">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Catalog" class="md-header__button md-logo" data-md-component="logo" href=".." title="Catalog">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Catalog
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Harvesting the Metadata
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Catalog" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Catalog">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Catalog
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Havesting Metadata
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Havesting Metadata
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-three-harvesters">
<span class="md-ellipsis">
      
        The Three Harvesters
      
    </span>
</a>
<nav aria-label="The Three Harvesters" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-fsgeodata-clearinghouse-fsgeodatapy">
<span class="md-ellipsis">
      
        1. FSGeodata Clearinghouse (fsgeodata.py)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-geospatial-data-discovery-gddpy">
<span class="md-ellipsis">
      
        2. Geospatial Data Discovery (gdd.py)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-research-data-archive-rdapy">
<span class="md-ellipsis">
      
        3. Research Data Archive (rda.py)
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-pattern">
<span class="md-ellipsis">
      
        Common Pattern
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-the-compiled-catalog">
<span class="md-ellipsis">
      
        Building the Compiled Catalog
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-design-decisions">
<span class="md-ellipsis">
      
        Key Design Decisions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-the-harvesters">
<span class="md-ellipsis">
      
        Running the Harvesters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#challenges">
<span class="md-ellipsis">
      
        Challenges
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      
        Next Steps
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cli/">
<span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-three-harvesters">
<span class="md-ellipsis">
      
        The Three Harvesters
      
    </span>
</a>
<nav aria-label="The Three Harvesters" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-fsgeodata-clearinghouse-fsgeodatapy">
<span class="md-ellipsis">
      
        1. FSGeodata Clearinghouse (fsgeodata.py)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-geospatial-data-discovery-gddpy">
<span class="md-ellipsis">
      
        2. Geospatial Data Discovery (gdd.py)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-research-data-archive-rdapy">
<span class="md-ellipsis">
      
        3. Research Data Archive (rda.py)
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#common-pattern">
<span class="md-ellipsis">
      
        Common Pattern
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-the-compiled-catalog">
<span class="md-ellipsis">
      
        Building the Compiled Catalog
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-design-decisions">
<span class="md-ellipsis">
      
        Key Design Decisions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-the-harvesters">
<span class="md-ellipsis">
      
        Running the Harvesters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#challenges">
<span class="md-ellipsis">
      
        Challenges
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      
        Next Steps
      
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="data-harvesting">Data Harvesting</h1>
<p>Timbercat harvests metadata from three different data sources. Each source has its own loader class that handles downloading and parsing.</p>
<h2 id="the-three-harvesters">The Three Harvesters</h2>
<h3 id="1-fsgeodata-clearinghouse-fsgeodatapy">1. FSGeodata Clearinghouse (<code>fsgeodata.py</code>)</h3>
<p>The most complex harvester. It scrapes an HTML datasets page to find metadata and service URLs.</p>
<p><strong>What it harvests:</strong></p>
<ul>
<li>XML metadata files (title, abstract, keywords, lineage)</li>
<li>MapServer JSON service definitions</li>
</ul>
<p><strong>How it works:</strong></p>
<pre><code class="language-python">class FSGeodataLoader:
    def download_all(self):
        # 1. Fetch the datasets page
        html_content = self.fetch_datasets_page()

        # 2. Parse HTML with BeautifulSoup to find links
        datasets = self.parse_datasets(html_content)

        # 3. Download each XML and JSON file
        for dataset in datasets:
            self.download_file(dataset["metadata_url"], ...)
            self.download_service_info(dataset["service_url"], ...)
</code></pre>
<p><strong>Output:</strong></p>
<ul>
<li><code>data/fsgeodata/metadata/*.xml</code></li>
<li><code>data/fsgeodata/services/*_service.json</code></li>
</ul>
<h3 id="2-geospatial-data-discovery-gddpy">2. Geospatial Data Discovery (<code>gdd.py</code>)</h3>
<p>The simplest harvester. Downloads a single JSON file from an ArcGIS Hub API endpoint.</p>
<p><strong>What it harvests:</strong></p>
<ul>
<li>DCAT-US formatted JSON catalog (title, description, keywords, themes)</li>
</ul>
<p><strong>How it works:</strong></p>
<pre><code class="language-python">class GeospatialDataDiscovery:
    def download_gdd_metadata(self):
        # Single API call to get all datasets
        response = requests.get(METADATA_SOURCE_URL)
        # Save entire catalog as one JSON file
</code></pre>
<p><strong>Output:</strong></p>
<ul>
<li><code>data/gdd/gdd_metadata.json</code></li>
</ul>
<h3 id="3-research-data-archive-rdapy">3. Research Data Archive (<code>rda.py</code>)</h3>
<p>Similar to GDD. Downloads a single JSON catalog file from a web service.</p>
<p><strong>What it harvests:</strong></p>
<ul>
<li>JSON catalog (title, description, keywords)</li>
</ul>
<p><strong>How it works:</strong></p>
<pre><code class="language-python">class RDALoader:
    def download(self):
        # Single API call
        response = requests.get(SOURCE_URL)
        json_data = response.json()
</code></pre>
<p><strong>Output:</strong></p>
<ul>
<li><code>data/rda/rda_metadata.json</code></li>
</ul>
<h2 id="common-pattern">Common Pattern</h2>
<p>All three harvesters follow the same two-phase pattern:</p>
<div class="mermaid">graph LR
    A[Download] --&gt; B[Parse]
    B --&gt; C[Vector DB]
</div>
<ol>
<li><strong>Download Phase</strong>: Fetch raw data (XML or JSON)</li>
<li><strong>Parse Phase</strong>: Extract fields and create standardized document objects</li>
</ol>
<p>Each parser creates documents with a common structure:</p>
<pre><code class="language-python">document = {
    "id": hash_string(title),
    "title": title,
    "description": description,  # or "abstract" for XML
    "keywords": keywords,
    "src": "gdd"  # or "rda" or "fsgeodata"
}
</code></pre>
<h2 id="building-the-compiled-catalog">Building the Compiled Catalog</h2>
<p>After downloading and parsing from all three sources, <code>build_docs_catalog()</code> creates a single unified catalog file.</p>
<p><strong>What it does:</strong></p>
<pre><code class="language-python">def build_docs_catalog():
    # 1. Create instances of all three loaders
    fsgeod = FSGeodataLoader()
    rda = RDALoader()
    gdd = GeospatialDataDiscovery()

    # 2. Parse metadata from each source
    fsgeo_docs = fsgeod.parse_metadata()
    rda_docs = rda.parse_metadata()
    gdd_docs = gdd.parse_metadata()

    # 3. Combine all documents into one list
    documents = fsgeo_docs + rda_docs + gdd_docs

    # 4. Save to a single JSON file
    save_json(documents, "data/catalog.json")
</code></pre>
<p><strong>Output:</strong></p>
<ul>
<li><code>data/catalog.json</code> - A single file containing all parsed documents from all three sources</li>
</ul>
<p>This compiled catalog serves as the input for loading into the vector database. Instead of reading hundreds of individual XML files and multiple JSON files, the vector database loader can simply read one consolidated file.</p>
<p><strong>Why this matters:</strong></p>
<ul>
<li><strong>Single source of truth</strong>: One file to maintain and version</li>
<li><strong>Faster loading</strong>: Vector DB can read one file instead of hundreds</li>
<li><strong>Easy inspection</strong>: You can examine the entire catalog structure in one place</li>
</ul>
<p><strong>Running it:</strong></p>
<pre><code class="language-bash"># Build the compiled catalog from all sources
timbercat build-docs-catalog
</code></pre>
<p>The command reports how many documents were parsed from each source and the total count.</p>
<h2 id="key-design-decisions">Key Design Decisions</h2>
<p><strong>Source Identification</strong>: Each document includes a <code>src</code> field to track which system it came from.</p>
<p><strong>ID Generation</strong>: Document IDs are generated by hashing the title, ensuring uniqueness and consistency.</p>
<p><strong>Error Handling</strong>: All harvesters handle missing files and failed requests gracefully.</p>
<p><strong>Rate Limiting</strong>: FSGeodata includes a 0.5s delay between requests to be respectful of server resources.</p>
<h2 id="running-the-harvesters">Running the Harvesters</h2>
<pre><code class="language-bash"># Download from Clearinghouse (XML + JSON)
timbercat download-fsgeodata

# Other sources can be added to the CLI similarly
</code></pre>
<h2 id="challenges">Challenges</h2>
<p><strong>Different Data Formats</strong>: XML (FSGeodata) vs JSON (GDD, RDA) require different parsing strategies.</p>
<p><strong>Inconsistent Schemas</strong>: Not all XML metadata files have the same structure. Defensive parsing with existence checks is essential.</p>
<p><strong>Missing Services</strong>: Some FSGeodata datasets don't have MapServer services. The harvester handles these gracefully.</p>
<h2 id="next-steps">Next Steps</h2>
<p>After harvesting, the parsed documents are loaded into ChromaDB for semantic search. See the implementation in <code>src/catalog/</code> for the full loader classes.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>